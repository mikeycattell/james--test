function renderBets(e,t,n){e.html(""),n.forEach(function(n){var a=t.clone();a.data(n),a.find(".bet__event").text(n.event),a.find(".bet__name").text(n.name),a.find(".bet__odds").text(formatOdds(n.odds)).data("odds",n.odds),e.append(a)})}function renderSelection(e,t){var n="selection-"+t.data("bet_id"),a=t.data();t.attr("id",n),t.find(".selection__title").text(a.event+" - "+a.name),t.find(".selection__returns").text("@ "+formatOdds(a.odds)+" could return £"+formatReturns(a.odds,0)),e.append(t)}function renderReceipt(e,t){var n=t.data(),a="receipt-"+n.bet_id;t.attr("id",a),t.find(".receipt__title").text(n.event+" - "+n.name),t.find(".receipt__stake").text("£"+n.stake+" @ "+formatOdds(n.odds)+" could return £"+formatReturns(n.odds,n.stake)),t.find(".receipt__transaction-id").text(n.transaction_id),e.append(t)}function removeSelection(e){$("#selection-"+e).remove()}function formatOdds(e){return e.numerator===e.denominator?"Evens":e.numerator+"/"+e.denominator}function formatReturns(e,t){var n=0;return t>0?((1+e.numerator/e.denominator)*t).toFixed(2):n.toFixed(2)}function betLoadError(e){console.error(e)}var templates=["bet","selection","receipt"],$templates={},betslip=[],$bets=$("#bets"),$selections=$("#selections"),$receipts=$("#receipts"),$app=$("body");templates.forEach(function(e){$templates[e]=$($("#"+e).html())}),$.get("http://skybettechtestapi.herokuapp.com/available").done(renderBets.bind(this,$bets,$templates.bet)).fail(betLoadError),$app.on("click",".js-odds",function(){var e=$(this).parent(".bet"),t=e.data("bet_id");if(-1===betslip.indexOf(t)){var n=$templates.selection.clone();n.data(e.data()),renderSelection($selections,n),betslip.push(t)}else removeSelection(t),betslip.splice(betslip.indexOf(t),1)}),$app.on("submit",".js-selection",function(e){e.preventDefault();var t=$(this),n=t.find(".js-stake").val(),a=t.find(".js-place-bet");if(n>0){var o=$.extend(t.data(),{stake:n});a.attr("disabled",!0),$.ajax({url:"http://skybettechtestapi.herokuapp.com/bets",method:"post",contentType:"application/json",data:JSON.stringify(o),dataType:"json"}).done(function(e){removeSelection(e.bet_id);var t=$templates.receipt.clone();t.data(e),renderReceipt($receipts,t)}).fail(function(e){t.addClass("is-invalid"),console.error(e)})}else t.addClass("is-invalid")}),$app.on("keyup",".js-stake",function(){var e=$(this).closest(".js-selection"),t=e.data(),n=parseFloat($(this).val());n>0?e.find(".js-place-bet").attr("disabled",!1):e.find(".js-place-bet").attr("disabled",!0),e.find(".js-returns").html("@ "+formatOdds(t.odds)+" could return £"+formatReturns(t.odds,n))}),$app.on("click",".js-toggle",function(e){e.preventDefault(),$(this).parent().find(".js-toggle-target").toggleClass("is-hidden")}),$(document).ready(function($){$('a[href^="#"]').bind("click.smoothscroll",function(e){e.preventDefault();var t=this.hash,n=$(t);$("html, body").stop().animate({scrollTop:n.offset().top-40},900,"swing",function(){window.location.hash=t})})});